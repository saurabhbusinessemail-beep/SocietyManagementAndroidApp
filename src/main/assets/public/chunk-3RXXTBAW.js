import{a as at}from"./chunk-JOE7VHKJ.js";import{a as Z}from"./chunk-OOMW2DR2.js";import{B as ot,C as it,D as rt,b as Q,c as W,n as X,w as tt,y as et,z as nt}from"./chunk-7RVF455G.js";import{C as B,K as Y,L as $,k as R,m as S,oa as H,p as q,pa as J,ra as K,v as U,y as P}from"./chunk-UR6Q7DSA.js";import{Ab as w,Cb as p,E as l,Ec as L,Fb as I,Fc as z,Ic as G,Lc as N,P as M,Sa as s,Ta as m,Ub as _,V as b,Zb as V,_b as A,da as j,ea as O,f as T,hb as k,jb as a,ma as y,na as v,rb as g,sb as u,tb as h,ub as C,vb as f,xb as D}from"./chunk-WBOKHTJO.js";import"./chunk-OQV6BHXQ.js";import{f as E}from"./chunk-CWTPBX7D.js";var pt=()=>({id:"",label:"Date"}),mt=()=>({id:"",label:"Contact"}),gt=()=>({id:"",label:"Purpose"}),ut=()=>({id:"",label:"Time"});function Ct(i,F){if(i&1){let t=D();C(0,11),g(1,"ui-button",12),w("clicked",function(){y(t);let n=p().$implicit,o=p();return v(o.onApprove(n))}),u(),g(2,"ui-button",13),w("clicked",function(){y(t);let n=p().$implicit,o=p();return v(o.onReject(n))}),u(),f()}}function ft(i,F){if(i&1&&(C(0),g(1,"app-card-v2",5),C(2,6),h(3,"ui-label",7),V(4,"uppercase"),f(),C(5,8),h(6,"ui-label",9)(7,"ui-label",9)(8,"ui-label",9),f(),k(9,Ct,3,0,"ng-container",10),u(),f()),i&2){let t,e=F.$implicit,n=p();s(),a("title",(t=e.visitorName)!==null&&t!==void 0?t:"")("status",n.getGateEntryStatusColorName(e))("smColumns",12)("mdColumns",6)("lgColumns",6),s(2),I("valueText",A(4,14,e.status)),a("valueType",n.getGateEntryLabelType(e)),s(3),a("config",_(16,mt))("valueText",e.visitorContact),s(),a("config",_(17,gt))("valueText",e.purpose),s(),a("config",_(18,ut))("valueText",n.formatTime(e.createdOn)),s(),a("ngIf",e.status==="requested")}}var st=(()=>{class i{constructor(t,e,n,o){this.gateEntryService=t,this.societyService=e,this.loginService=n,this.router=o,this.gateEntries=[],this.societyOptions=[],this.flatOptions=[],this.isComponentActive=new T,this.societiesSearchControl=new P(void 0),this.flatControl=new P(void 0),this.selectedDateControl=new P(new Date().toISOString().split("T")[0]),this.societiesSearchConfig={id:"society",label:"Society",placeholder:"Search Society"},this.flatSearchConfig={id:"flat",label:"Flat",placeholder:"Search Flat"}}ngOnInit(){if(this.myProfile=this.loginService.getProfileFromStorage(),!this.myProfile){this.router.navigateByUrl("/");return}this.subscribeToDateChange(),this.subscribeToFlatSelection(),this.subscribeToSocietySelection(this.myProfile),this.loadMySocities(this.myProfile)}getGateEntryStatusColorName(t){switch(t.status){case"approved":return"approved";case"cancelled":return"rejected";case"completed":return"approved";case"expired":return"expired";case"rejected":return"rejected";case"requested":return"pending"}}getGateEntryLabelType(t){switch(t.status){case"approved":return"active";case"cancelled":return"rejected";case"completed":return"active";case"expired":return"inactive";case"rejected":return"rejected";case"requested":return"pending"}}loadMySocities(t){this.societyService.getAllSocieties().pipe(l(1)).subscribe({next:e=>{let n=e.data;this.societyOptions=n.map(o=>({label:o.societyName,value:o._id})),n.length===1?this.societiesSearchControl.setValue({label:n[0].societyName,value:n[0]._id}):this.loadDefaultFlats(t)}})}subscribeToSocietySelection(t){this.societiesSearchControl.valueChanges.pipe(M(this.isComponentActive)).subscribe(e=>{this.flatControl.reset();let n=t.user.role==="admin";if(e){let o=t.socities.find(r=>r.societyId===e.value)?.societyRoles?.find(r=>["manager","societyadmin"].includes(r.name)),c=t.socities.find(r=>r.societyId===e.value)?.societyRoles?.find(r=>["owner","member","tenant"].includes(r.name));n||o?this.loadSocietyFlats(e.value):c&&this.loadAllMyFlats(e.value)}else this.loadDefaultFlats(t)})}loadDefaultFlats(t){return E(this,null,function*(){let e=t.user.role==="admin",n=t.socities.filter(r=>r.societyRoles.some(d=>["manager","societyadmin"].includes(d.name))),o=t.socities.some(r=>r.societyRoles.some(d=>["owner","member","tenant"].includes(d.name)));if(e){this.flatOptions=[];return}let c=[];if(n.length>0){let r=n.map(x=>this.loadSocietyFlats(x.societyId,!1));(yield Promise.all(r)).forEach(x=>x.forEach(dt=>c.push(dt)))}o&&((yield this.loadAllMyFlats(void 0,!1)).forEach(d=>c.push(d)),this.flatOptions=c),this.loadGateEntries()})}loadAllMyFlats(t,e=!0){return new Promise(n=>{this.societyService.myFlats(t).pipe(l(1)).subscribe(o=>{if(!o.success){n([]);return}let c=o.data.map(r=>this.societyService.convertFlatMemberToDropdownOption(r));e&&(this.flatOptions=c,this.loadGateEntries()),n(c)})})}loadSocietyFlats(t,e=!0){return new Promise(n=>{this.societyService.getFlats(t).pipe(l(1)).subscribe(o=>{if(!o.success){n([]);return}let c=o.data.map(r=>this.societyService.convertFlatToDropdownOption(r,this.societiesSearchControl.value?.value));e&&(this.flatOptions=c,this.loadGateEntries()),n(c)})})}subscribeToFlatSelection(){this.flatControl.valueChanges.pipe(M(this.isComponentActive)).subscribe(t=>{this.loadGateEntries()})}loadGateEntries(){let t=this.societiesSearchControl.value?.value??void 0,e=this.flatControl.value?.value??void 0,n=this.selectedDateControl.value?new Date(this.selectedDateControl.value):void 0;this.gateEntryService.getAllMyGateEntries(t,e,void 0,n).pipe(l(1)).subscribe({next:o=>{o.success&&(this.gateEntries=o.data)}})}subscribeToDateChange(){this.selectedDateControl.valueChanges.pipe(M(this.isComponentActive)).subscribe(t=>{this.loadGateEntries()})}formatTime(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}onApprove(t){this.gateEntryService.changeStatus(t._id,"approved").pipe(l(1)).subscribe({next:e=>{e.success&&this.loadGateEntries()}})}onReject(t){this.gateEntryService.changeStatus(t._id,"rejected").pipe(l(1)).subscribe({next:e=>{e.success&&this.loadGateEntries()}})}getStatusClass(t){switch(t){case"approved":return"status-approved";case"rejected":return"status-rejected";case"requested":return"status-requested";case"completed":return"status-completed";default:return"status-default"}}static{this.\u0275fac=function(e){return new(e||i)(m(at),m(Z),m(q),m(R))}}static{this.\u0275cmp=j({type:i,selectors:[["app-visitor-list"]],decls:6,vars:20,consts:[[3,"hideMoreActions"],["placeholder","Search Society",3,"formControl","config","options","smColumns","mdColumns","lgColumns"],["placeholder","Search Flat",3,"formControl","config","options","smColumns","mdColumns","lgColumns"],[3,"formControl","config","smColumns","mdColumns","lgColumns"],[4,"ngFor","ngForOf"],[3,"title","status","smColumns","mdColumns","lgColumns"],["card-info",""],["direction","horizontal",3,"valueText","valueType"],["card-body",""],["direction","vertical","valueType","info",3,"config","valueText"],["card-actions","",4,"ngIf"],["card-actions",""],["label","Approve",3,"clicked"],["label","Reject","type","error",3,"clicked"]],template:function(e,n){e&1&&(g(0,"app-layout",0)(1,"ui-form-layout"),h(2,"ui-select2",1)(3,"ui-select2",2)(4,"ui-date",3),k(5,ft,10,19,"ng-container",4),u()()),e&2&&(a("hideMoreActions",!0),s(2),a("formControl",n.societiesSearchControl)("config",n.societiesSearchConfig)("options",n.societyOptions)("smColumns",12)("mdColumns",5)("lgColumns",5),s(),a("formControl",n.flatControl)("config",n.flatSearchConfig)("options",n.flatOptions)("smColumns",12)("mdColumns",5)("lgColumns",5),s(),a("formControl",n.selectedDateControl)("config",_(19,pt))("smColumns",12)("mdColumns",2)("lgColumns",2),s(),a("ngForOf",n.gateEntries))},dependencies:[L,z,Q,W,H,J,et,tt,ot,X,U,B,G],styles:['.timeline-container[_ngcontent-%COMP%]{font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;color:#333;padding:16px;background:#f5f7fa;min-height:100vh}.date-selector[_ngcontent-%COMP%]{margin-bottom:24px;background:#fff;padding:16px;border-radius:8px;box-shadow:0 2px 4px #0000001a}.date-selector[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-weight:600;color:#2c3e50}.date-selector[_ngcontent-%COMP%]   .date-input[_ngcontent-%COMP%]{width:100%;max-width:300px;padding:10px 16px;border:2px solid #e0e6ed;border-radius:6px;font-size:16px;transition:border-color .3s}.date-selector[_ngcontent-%COMP%]   .date-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3498db;box-shadow:0 0 0 3px #3498db33}.timeline-header[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:8px;margin-bottom:24px;box-shadow:0 2px 4px #0000001a}.timeline-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#2c3e50;font-size:1.5rem}.timeline-header[_ngcontent-%COMP%]   .entry-count[_ngcontent-%COMP%]{margin:8px 0 0;color:#7f8c8d;font-size:.9rem}@media (max-width: 767px){.timeline-mobile[_ngcontent-%COMP%]{display:block}}@media (min-width: 768px) and (max-width: 991px){.timeline-mobile[_ngcontent-%COMP%]{display:none}}@media (min-width: 992px){.timeline-mobile[_ngcontent-%COMP%]{display:none}}.timeline-mobile[_ngcontent-%COMP%]   .mobile-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;margin-bottom:16px;box-shadow:0 2px 8px #0000001a;overflow:hidden;border-left:4px solid #3498db}.timeline-mobile[_ngcontent-%COMP%]   .mobile-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;background:#f8f9fa;border-bottom:1px solid #e0e6ed}.timeline-mobile[_ngcontent-%COMP%]   .mobile-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .time-badge[_ngcontent-%COMP%]{background:#3498db;color:#fff;padding:6px 12px;border-radius:20px;font-weight:600;font-size:.9rem}.timeline-mobile[_ngcontent-%COMP%]   .mobile-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{padding:16px}.timeline-mobile[_ngcontent-%COMP%]   .mobile-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .entry-info[_ngcontent-%COMP%]   .entry-name[_ngcontent-%COMP%]{margin:0 0 12px;color:#2c3e50;font-size:1.1rem}.timeline-mobile[_ngcontent-%COMP%]   .mobile-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .entry-info[_ngcontent-%COMP%]   .entry-contact[_ngcontent-%COMP%], .timeline-mobile[_ngcontent-%COMP%]   .mobile-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .entry-info[_ngcontent-%COMP%]   .entry-purpose[_ngcontent-%COMP%], .timeline-mobile[_ngcontent-%COMP%]   .mobile-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .entry-info[_ngcontent-%COMP%]   .entry-time[_ngcontent-%COMP%]{margin:8px 0;color:#5a6c7d;display:flex;align-items:center}.timeline-mobile[_ngcontent-%COMP%]   .mobile-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .entry-info[_ngcontent-%COMP%]   .entry-contact[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .timeline-mobile[_ngcontent-%COMP%]   .mobile-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .entry-info[_ngcontent-%COMP%]   .entry-purpose[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .timeline-mobile[_ngcontent-%COMP%]   .mobile-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .entry-info[_ngcontent-%COMP%]   .entry-time[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:8px;font-style:normal}@media (max-width: 767px){.timeline-desktop[_ngcontent-%COMP%]{display:none}}@media (min-width: 768px) and (max-width: 991px){.timeline-desktop[_ngcontent-%COMP%]{display:block}}@media (min-width: 992px){.timeline-desktop[_ngcontent-%COMP%]{display:block}}.timeline-desktop[_ngcontent-%COMP%]   .timeline[_ngcontent-%COMP%]{position:relative;padding:20px 0}.timeline-desktop[_ngcontent-%COMP%]   .timeline[_ngcontent-%COMP%]:before{content:"";position:absolute;left:50px;top:0;bottom:0;width:2px;background:linear-gradient(to bottom,#3498db,#2ecc71);transform:translate(-50%)}.timeline-desktop[_ngcontent-%COMP%]   .timeline-item[_ngcontent-%COMP%]{display:flex;margin-bottom:24px;position:relative}.timeline-desktop[_ngcontent-%COMP%]   .timeline-marker[_ngcontent-%COMP%]{width:20px;height:20px;border-radius:50%;background:#3498db;border:3px solid white;box-shadow:0 0 0 3px #3498db;z-index:1;flex-shrink:0;margin-right:30px}.timeline-desktop[_ngcontent-%COMP%]   .timeline-marker.status-approved[_ngcontent-%COMP%]{background:#2ecc71;box-shadow:0 0 0 3px #2ecc71}.timeline-desktop[_ngcontent-%COMP%]   .timeline-marker.status-rejected[_ngcontent-%COMP%]{background:#e74c3c;box-shadow:0 0 0 3px #e74c3c}.timeline-desktop[_ngcontent-%COMP%]   .timeline-marker.status-requested[_ngcontent-%COMP%]{background:#f39c12;box-shadow:0 0 0 3px #f39c12}.timeline-desktop[_ngcontent-%COMP%]   .timeline-marker.status-completed[_ngcontent-%COMP%]{background:#9b59b6;box-shadow:0 0 0 3px #9b59b6}.timeline-desktop[_ngcontent-%COMP%]   .timeline-content[_ngcontent-%COMP%]{flex:1;min-width:0}.timeline-desktop[_ngcontent-%COMP%]   .timeline-time[_ngcontent-%COMP%]{font-size:.9rem;color:#7f8c8d;margin-bottom:8px;font-weight:500}.timeline-desktop[_ngcontent-%COMP%]   .desktop-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 4px 12px #0000001a;overflow:hidden;transition:transform .3s,box-shadow .3s}.timeline-desktop[_ngcontent-%COMP%]   .desktop-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 16px #00000026}.timeline-desktop[_ngcontent-%COMP%]   .desktop-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.timeline-desktop[_ngcontent-%COMP%]   .desktop-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .entry-name[_ngcontent-%COMP%]{margin:0;font-size:1.2rem;font-weight:600}.timeline-desktop[_ngcontent-%COMP%]   .desktop-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:24px}.timeline-desktop[_ngcontent-%COMP%]   .desktop-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:20px}.timeline-desktop[_ngcontent-%COMP%]   .desktop-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]{display:flex;flex-direction:column}.timeline-desktop[_ngcontent-%COMP%]   .desktop-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .info-label[_ngcontent-%COMP%]{font-size:.85rem;color:#7f8c8d;margin-bottom:4px;font-weight:500}.timeline-desktop[_ngcontent-%COMP%]   .desktop-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .info-value[_ngcontent-%COMP%]{font-size:1rem;color:#2c3e50}.status-badge[_ngcontent-%COMP%]{padding:6px 12px;border-radius:20px;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.status-badge.status-approved[_ngcontent-%COMP%]{background:#d5f4e6;color:#27ae60}.status-badge.status-rejected[_ngcontent-%COMP%]{background:#fde8e8;color:#e74c3c}.status-badge.status-requested[_ngcontent-%COMP%]{background:#fef9e7;color:#f39c12}.status-badge.status-completed[_ngcontent-%COMP%]{background:#f4ecf7;color:#8e44ad}.card-actions[_ngcontent-%COMP%]{display:flex;gap:12px;margin-top:16px}.card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:6px;font-weight:600;cursor:pointer;transition:all .3s;font-size:.9rem}.card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}.card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:active{transform:translateY(0)}.card-actions[_ngcontent-%COMP%]   .btn-approve[_ngcontent-%COMP%]{background:#2ecc71;color:#fff}.card-actions[_ngcontent-%COMP%]   .btn-approve[_ngcontent-%COMP%]:hover{background:#27ae60;box-shadow:0 4px 12px #2ecc714d}.card-actions[_ngcontent-%COMP%]   .btn-reject[_ngcontent-%COMP%]{background:#e74c3c;color:#fff}.card-actions[_ngcontent-%COMP%]   .btn-reject[_ngcontent-%COMP%]:hover{background:#c0392b;box-shadow:0 4px 12px #e74c3c4d}.no-entries[_ngcontent-%COMP%], .no-entries-desktop[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#7f8c8d}.no-entries[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .no-entries-desktop[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.empty-state[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{font-size:48px;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#2c3e50;margin:16px 0}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#7f8c8d;margin:0}@media (min-width: 768px) and (max-width: 991px){.info-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)!important}.desktop-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{padding:16px 20px!important}.desktop-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:20px!important}}@media (min-width: 992px){.timeline-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:24px}.info-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)!important}}']})}}return i})();var _t=[{path:"",pathMatch:"full",redirectTo:"list"},{path:"list",component:st}],lt=(()=>{class i{static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275mod=O({type:i})}static{this.\u0275inj=b({imports:[S.forChild(_t),S]})}}return i})();var Jt=(()=>{class i{static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275mod=O({type:i})}static{this.\u0275inj=b({imports:[N,lt,rt,it,nt,K,Y,$]})}}return i})();export{Jt as VisitorModule};
