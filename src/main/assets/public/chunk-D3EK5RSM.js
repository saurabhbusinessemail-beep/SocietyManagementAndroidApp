import{b as U}from"./chunk-YOQQ5CTQ.js";import"./chunk-SCWYC5GG.js";import{a as H,d as J}from"./chunk-BXTUOHYQ.js";import{C as N,D as j,F as D,H as G,K as R,L as A,M as q,N as B,O as $,o as S,r as P,sa as z,t as V,ta as K,v,x as E,y as k}from"./chunk-KWNZ2CR7.js";import{Ab as g,Cb as p,Dc as M,E as m,Fc as L,Lb as l,Lc as O,Nb as h,Sa as o,Ta as f,V as x,Wb as y,Zb as F,_b as I,da as T,ea as _,hb as b,jb as a,ma as d,na as u,rb as r,sb as n,tb as C,xb as w}from"./chunk-WBOKHTJO.js";import"./chunk-OQV6BHXQ.js";import"./chunk-CWTPBX7D.js";var Q=(t,c)=>({primary:t,cancel:c});function ee(t,c){if(t&1){let e=w();r(0,"div",1)(1,"div",2)(2,"h1",3),l(3,"Login"),n(),r(4,"form",4),g("ngSubmit",function(){d(e);let s=p();return u(s.sendOtp())}),r(5,"div",5)(6,"label",6),l(7,"Phone Number"),n(),C(8,"input",7),n(),r(9,"button",8),l(10),n()()()()}if(t&2){let e=p();o(4),a("formGroup",e.loginForm),o(5),a("disabled",e.loginForm.invalid||e.isLoading),o(),h(" ",e.isLoading?"Sending\u2026":"Send OTP"," ")}}function te(t,c){if(t&1&&(r(0,"p",18),l(1),F(2,"timeFormat"),n()),t&2){let e=p(2);o(),h("Time remaining: ",I(2,1,e.countdown),"")}}function ie(t,c){t&1&&(r(0,"p",19),l(1,"OTP verification failed. Try again."),n())}function ne(t,c){if(t&1){let e=w();r(0,"div",1)(1,"div",2)(2,"button",9),g("click",function(){d(e);let s=p();return u(s.resetToLogin())}),C(3,"app-icon",10),n(),r(4,"p",11),l(5),n(),r(6,"form",4),g("ngSubmit",function(){d(e);let s=p();return u(s.verifyOtp())}),r(7,"div",5)(8,"label",12),l(9,"Enter OTP"),n(),C(10,"input",13),n(),b(11,te,3,3,"p",14),r(12,"button",15),l(13),n(),r(14,"button",16),g("click",function(){d(e);let s=p();return u(s.resendOtp())}),l(15," Resend OTP "),n(),b(16,ie,2,0,"p",17),n()()()}if(t&2){let e=p();o(5),h("OTP sent to ",e.loginForm.value.phone,""),o(),a("formGroup",e.otpForm),o(5),a("ngIf",e.countdown>0),o(),a("ngClass",y(10,Q,e.countdown>0&&!e.otpForm.invalid,!e.countdown||e.otpForm.invalid))("disabled",e.otpForm.invalid||e.isVerifying)("disabled",!e.countdown),o(),h(" ",e.isVerifying?"Verifying\u2026":"Verify OTP"," "),o(),a("ngClass",y(13,Q,!e.countdown,e.countdown>0))("disabled",e.countdown>0),o(2),a("ngIf",e.otpError)}}var X=(()=>{class t{constructor(e,i,s,Z){this.fb=e,this.loginService=i,this.userService=s,this.fcmTokenService=Z,this.step="login",this.isLoading=!1,this.isVerifying=!1,this.countDownTimer=300,this.countdown=this.countDownTimer,this.otpError=!1,this.loginForm=this.fb.group({phone:["",[v.required,v.pattern("^[0-9]{10}$")]]}),this.otpForm=this.fb.group({otp:["",[v.required,v.pattern("^[0-9]{6}$")]]})}sendOtp(){this.loginForm.invalid||(this.isLoading=!0,this.loginService.sendOTP(this.loginForm.value.phone).pipe(m(1)).subscribe({next:()=>{this.isLoading=!1,this.step="otp",this.startCountdown()},error:e=>{this.isLoading=!1}}))}startCountdown(){this.countdown=this.countDownTimer,clearInterval(this.countdownInterval),this.countdownInterval=setInterval(()=>{this.countdown>0?this.countdown--:clearInterval(this.countdownInterval)},1e3)}resendOtp(){this.countdown>0||this.sendOtp()}verifyOtp(){this.otpForm.invalid||(this.isVerifying=!0,this.otpError=!1,this.loginService.verifyOTP(this.loginForm.value.phone,this.otpForm.value.otp).pipe(m(1)).subscribe({next:e=>{if(this.isVerifying=!1,!e.success){this.otpError=!0;return}e?.token&&(this.loginService.saveTokenToStorage(e.token),this.getAndSaveProfile())},error:e=>{this.isVerifying=!1,this.otpError=!0}}))}getAndSaveProfile(){this.isVerifying=!0,this.loginService.loadProfile().pipe(m(1)).subscribe(e=>{if(this.isVerifying=!1,!e||!e.success){this.otpError=!0;return}let i=this.fcmTokenService.fcmToken;i&&this.userService.updateFCMToken(i).pipe(m(1)).subscribe()})}resetToLogin(){this.step="login",this.otpError=!1,this.isLoading=!1,this.isVerifying=!1,clearInterval(this.countdownInterval)}static{this.\u0275fac=function(i){return new(i||t)(f(A),f(P),f($),f(U))}}static{this.\u0275cmp=T({type:t,selectors:[["app-login"]],decls:2,vars:2,consts:[["class","login-container",4,"ngIf"],[1,"login-container"],[1,"login-card"],[1,"page-header"],[1,"login-form",3,"ngSubmit","formGroup"],[1,"form-group"],["for","phone"],["type","tel","id","phone","formControlName","phone","placeholder","Enter phone number",1,"input"],["type","submit",1,"btn","primary","login-btn",3,"disabled"],[1,"btn","primary",3,"click"],["name","arrow-left","color","white"],[1,"section-header"],["for","otp"],["id","otp","type","number","formControlName","otp","maxlength","6","placeholder","Enter 6-digit OTP",1,"input"],["class","note",4,"ngIf"],["type","submit",1,"btn","login-btn",3,"ngClass","disabled"],["type","button",1,"btn","login-btn",3,"click","ngClass","disabled"],["class","error-message",4,"ngIf"],[1,"note"],[1,"error-message"]],template:function(i,s){i&1&&b(0,ee,11,3,"div",0)(1,ne,17,16,"div",0),i&2&&(a("ngIf",s.step==="login"),o(),a("ngIf",s.step==="otp"))},dependencies:[M,L,z,N,V,j,E,k,R,D,G,H],styles:[".login-container[_ngcontent-%COMP%]{height:100vh;display:flex;align-items:center;justify-content:center;background:#f1f1f1;padding:24px}.login-card[_ngcontent-%COMP%]{background:#fff;padding:32px;border-radius:12px;width:100%;max-width:420px;box-shadow:0 4px 14px #0000001a}.login-card[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]{color:#0b4da0}@media (max-width: 767px){.login-card[_ngcontent-%COMP%]{padding:24px}}.login-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:14px;color:#000;font-weight:500}.login-btn[_ngcontent-%COMP%]{margin-top:8px;width:100%}.error-message[_ngcontent-%COMP%]{color:#ff4d4d;font-weight:600}"]})}}return t})();var oe=[{path:"",component:X}],Y=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=_({type:t})}static{this.\u0275inj=x({imports:[S.forChild(oe),S]})}}return t})();var Te=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=_({type:t})}static{this.\u0275inj=x({imports:[O,Y,K,q,B,J]})}}return t})();export{Te as LoginModule};
