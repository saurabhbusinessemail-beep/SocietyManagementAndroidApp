import{a as Ot,b as wt}from"./chunk-R5HVBPFA.js";import{c as ht,d as _t}from"./chunk-BXTUOHYQ.js";import{a as xt}from"./chunk-H5A3E2HY.js";import{B as It,E as St,F as Tt,d as I,e as S,f as bt,l as vt,p as V,x as Mt,y as U}from"./chunk-PWWNUZIU.js";import{A as f,C as mt,E as pt,F as ct,H as dt,M as ut,N as Ct,d as it,k as nt,m as ot,o as q,p as lt,qa as ft,r as rt,ra as N,sa as gt,ta as yt,v as F,x as D,y as st,z as at}from"./chunk-KWNZ2CR7.js";import{Ab as d,Bc as X,Cb as m,Dc as Y,E as h,Ec as Z,Fc as j,Hc as tt,Lb as c,Lc as et,Nb as C,P as H,Sa as r,Ta as u,U as J,Ub as Q,V as L,Vb as W,Z as K,Zb as x,_b as M,da as _,ea as E,f as A,hb as O,jb as l,ma as y,na as b,rb as a,sb as s,tb as p,ub as w,vb as P,xb as v}from"./chunk-WBOKHTJO.js";import"./chunk-OQV6BHXQ.js";import{a as z,b as R,f as G}from"./chunk-CWTPBX7D.js";var B=(()=>{class n{constructor(t){this.http=t,this.baseUrl=`${lt.apiBaseUrl}/complaint`,this.statusTree={submitted:["approved","rejected","closed"],approved:["rejected","in_progress","closed"],in_progress:["rejected","resolved"],resolved:["closed"]}}newComplaint(t){return this.http.post(`${this.baseUrl}/add`,t)}deleteComplaint(t){return this.http.delete(`${this.baseUrl}/${t}`)}getComplaints(t,i,e){let o={};return t&&(o={societyId:t}),i&&(o=R(z({},o),{flatId:i})),e&&(o=R(z({},o),{complaintType:e})),this.http.post(`${this.baseUrl}`,o)}isStatusTransitionAllowed(t,i){let e=this.statusTree[t];return e?e.includes(i):!1}changeStatus(t,i){return this.http.post(`${this.baseUrl}/${t}/changeStatus`,{newStatus:i})}static{this.\u0275fac=function(i){return new(i||n)(K(it))}}static{this.\u0275prov=J({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var $t=n=>[n],zt=()=>[];function Rt(n,g){if(n&1){let t=v();a(0,"ui-button",27),d("clicked",function(){y(t);let e=m().$implicit,o=m();return b(o.changeStatus(e,"approved"))}),p(1,"app-icon",28),s()}n&2&&l("smColumns",12)("mdColumns",12)("lgColumns",12)}function qt(n,g){if(n&1){let t=v();a(0,"ui-button",29),d("clicked",function(){y(t);let e=m().$implicit,o=m();return b(o.changeStatus(e,"rejected"))}),p(1,"app-icon",30),s()}n&2&&l("smColumns",12)("mdColumns",12)("lgColumns",12)}function Gt(n,g){if(n&1){let t=v();a(0,"ui-button",31),d("clicked",function(){y(t);let e=m().$implicit,o=m();return b(o.changeStatus(e,"in_progress"))}),p(1,"app-icon",32),s()}n&2&&l("smColumns",12)("mdColumns",12)("lgColumns",12)}function Ht(n,g){if(n&1){let t=v();a(0,"ui-button",33),d("clicked",function(){y(t);let e=m().$implicit,o=m();return b(o.changeStatus(e,"resolved"))}),p(1,"app-icon",34),s()}n&2&&l("smColumns",12)("mdColumns",12)("lgColumns",12)}function Jt(n,g){if(n&1){let t=v();a(0,"ui-button",35),d("clicked",function(){y(t);let e=m().$implicit,o=m();return b(o.changeStatus(e,"closed"))}),p(1,"app-icon",36),s()}n&2&&l("smColumns",12)("mdColumns",12)("lgColumns",12)}function Kt(n,g){if(n&1&&(w(0),a(1,"ui-card",8),w(2,9),a(3,"div",10),c(4),x(5,"titlecase"),s(),a(6,"div",11),c(7),s(),a(8,"div",12)(9,"b"),c(10,"Society: "),s(),c(11),x(12,"titlecase"),s(),a(13,"div",13)(14,"b"),c(15,"Flat: "),s(),c(16),s(),a(17,"div",14)(18,"b"),c(19,"Priority: "),s(),c(20),x(21,"titlecase"),s(),a(22,"div",15),O(23,Rt,2,3,"ui-button",16)(24,qt,2,3,"ui-button",17)(25,Gt,2,3,"ui-button",18)(26,Ht,2,3,"ui-button",19)(27,Jt,2,3,"ui-button",20),s(),P(),w(28,21),a(29,"div",22)(30,"div",23),c(31),x(32,"smartDate"),s(),a(33,"div",24)(34,"div",25),c(35),x(36,"titlecase"),s(),a(37,"div",26),c(38),s()()(),P(),s(),P()),n&2){let t,i,e=g.$implicit,o=m();r(),l("smColumns",12)("mdColumns",6)("lgColumns",6),r(3),C(" ",M(5,18,e.title)," "),r(3),C(" ",e.description," "),r(4),C(" ",M(12,20,(t=o.getSociety(e))==null?null:t.societyName)," "),r(5),C(" ",((i=o.getFlat(e))==null?null:i.floor)+":"+((i=o.getFlat(e))==null?null:i.flatNumber)," "),r(4),C(" ",M(21,22,e.priority)," "),r(3),l("ngIf",o.isStatusTransitionAllowed(e,"approved")&&o.amIManagerOfSociety(e)),r(),l("ngIf",o.isStatusTransitionAllowed(e,"rejected")&&o.amIManagerOfSociety(e)),r(),l("ngIf",o.isStatusTransitionAllowed(e,"in_progress")&&o.amIManagerOfSociety(e)),r(),l("ngIf",o.isStatusTransitionAllowed(e,"resolved")&&o.amIManagerOfSociety(e)),r(),l("ngIf",o.isStatusTransitionAllowed(e,"closed")&&o.isMyComplaint(e)),r(4),C(" ",M(32,24,e.createdOn)," "),r(3),l("ngClass",e.status),r(),C(" ",M(36,26,e.status)," "),r(2),l("ngClass",e.complaintType.toString()),r(),C(" ",e.complaintType," ")}}var At=(()=>{class n{constructor(t,i,e){this.loginService=t,this.router=i,this.complaintService=e,this.complaints=[],this.societyOptions=[],this.flatOptions=[],this.complaintTypeOptions=[{label:"All",value:void 0},{label:"Private",value:"Private"},{label:"Public",value:"Public"}],this.selectedFIlter={},this.isFlatMember=!1,this.isComponentActive=new A,this.complaintTypeControl=new f(this.complaintTypeOptions[0]),this.complaintTypeConfig={id:"complaintType",label:"Complaint Type",formControl:this.complaintTypeControl,dropDownOptions:this.complaintTypeOptions}}ngOnInit(){if(this.myProfile=this.loginService.getProfileFromStorage(),!this.myProfile){this.router.navigateByUrl("/");return}}getSociety(t){return typeof t.societyId=="string"?void 0:t.societyId}getFlat(t){return typeof t.flatId=="string"?void 0:t.flatId}isStatusTransitionAllowed(t,i){return this.complaintService.isStatusTransitionAllowed(t.status,i)}amIManagerOfSociety(t){let i=typeof t.societyId=="string"?t.societyId:t.societyId._id;return this.myProfile?this.myProfile.socities.find(e=>e.societyId===i)?.societyRoles?.some(e=>["manager","societyadmin"].includes(e.name))??!1:!1}isMyComplaint(t){let i=typeof t.createdByUserId=="string"?t.createdByUserId:t.createdByUserId._id;return this.myProfile?this.myProfile.user._id===i:!1}openAddComplaint(){return G(this,null,function*(){let t=this.selectedFIlter.societyId,i=this.selectedFIlter.flatId;t&&i?this.router.navigate(["complaints",t,"add",i]):t?this.router.navigate(["complaints",t,"add"]):i?this.router.navigate(["complaints","add",i]):this.router.navigate(["complaints","add"])})}loadComplaints(t){this.selectedFIlter=t,this.complaints=[],this.complaintService.getComplaints(t.societyId,t.flatId,t.complaintType).pipe(h(1)).subscribe({next:i=>{this.complaints=i.data}})}changeStatus(t,i){this.isStatusTransitionAllowed(t,i)&&this.complaintService.changeStatus(t._id,i).pipe(h(1)).subscribe({next:e=>{e.success&&this.loadComplaints(this.selectedFIlter)}})}ngOnDestroy(){this.isComponentActive.next(),this.isComponentActive.complete()}static{this.\u0275fac=function(i){return new(i||n)(u(rt),u(ot),u(B))}}static{this.\u0275cmp=_({type:n,selectors:[["app-complaint-list"]],decls:8,vars:18,consts:[[3,"hideMoreActions"],["moreActions",""],["label","New Complaint","type","primary",3,"clicked","smColumns","mdColumns","lgColumns"],[1,"flex-col","full-h"],[3,"isFlatMemberChanged","filterChanged","dropDownControlConfigs","smColumns","mdColumns","lgColumns"],[3,"formControl","config","options","smColumns","mdColumns","lgColumns"],[1,"flex-auto"],[4,"ngFor","ngForOf"],["height","160px",3,"smColumns","mdColumns","lgColumns"],["card-main",""],[1,"title"],[1,"subtitle"],[1,"society"],[1,"flat"],[1,"priority"],[1,"action"],["type","only-content","label","Approve","class","approved",3,"smColumns","mdColumns","lgColumns","clicked",4,"ngIf"],["type","only-content","label","Reject","class","rejected",3,"smColumns","mdColumns","lgColumns","clicked",4,"ngIf"],["type","only-content","label","Move To Progress","class","in_progress",3,"smColumns","mdColumns","lgColumns","clicked",4,"ngIf"],["type","only-content","label","Mark Resolved","class","resolved",3,"smColumns","mdColumns","lgColumns","clicked",4,"ngIf"],["type","only-content","label","Close","class","closed",3,"smColumns","mdColumns","lgColumns","clicked",4,"ngIf"],["card-icon",""],[1,"right-container"],[1,"date"],[1,"stat"],[1,"status",3,"ngClass"],[1,"type",3,"ngClass"],["type","only-content","label","Approve",1,"approved",3,"clicked","smColumns","mdColumns","lgColumns"],["name","approve","size","md"],["type","only-content","label","Reject",1,"rejected",3,"clicked","smColumns","mdColumns","lgColumns"],["name","reject","size","md"],["type","only-content","label","Move To Progress",1,"in_progress",3,"clicked","smColumns","mdColumns","lgColumns"],["name","inProgress","size","sm"],["type","only-content","label","Mark Resolved",1,"resolved",3,"clicked","smColumns","mdColumns","lgColumns"],["name","resolve","size","sm"],["type","only-content","label","Close",1,"closed",3,"clicked","smColumns","mdColumns","lgColumns"],["name","close","size","sm"]],template:function(i,e){if(i&1&&(a(0,"app-layout",0),w(1,1),a(2,"ui-button",2),d("clicked",function(){return e.openAddComplaint()}),s(),P(),a(3,"div",3)(4,"app-filter",4),d("isFlatMemberChanged",function($){return e.isFlatMember=$})("filterChanged",function($){return e.loadComplaints($)}),p(5,"ui-select2",5),s(),a(6,"ui-form-layout",6),O(7,Kt,39,28,"ng-container",7),s()()()),i&2){let o;l("hideMoreActions",!e.isFlatMember),r(2),l("smColumns",1)("mdColumns",1)("lgColumns",1),r(2),l("dropDownControlConfigs",W(15,$t,e.complaintTypeConfig))("smColumns",12)("mdColumns",12)("lgColumns",12),r(),l("formControl",e.complaintTypeControl)("config",e.complaintTypeConfig)("options",(o=e.complaintTypeConfig.dropDownOptions)!==null&&o!==void 0?o:Q(17,zt))("smColumns",12)("mdColumns",2)("lgColumns",2),r(2),l("ngForOf",e.complaints)}},dependencies:[Y,Z,j,I,S,N,Mt,U,V,D,pt,gt,Ot,tt,ht],styles:[".form-layout[_ngcontent-%COMP%]     .card-main{height:inherit;max-width:calc(100% - 100px)}.form-layout[_ngcontent-%COMP%]     .card-icon{height:inherit;align-items:baseline}.title[_ngcontent-%COMP%]{color:#0b4da0;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.subtitle[_ngcontent-%COMP%]{color:#4c4545;font-size:12px;margin-top:-7px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.society[_ngcontent-%COMP%], .flat[_ngcontent-%COMP%], .priority[_ngcontent-%COMP%]{font-size:12px}.right-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.right-container[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{font-size:12px;text-align:end;color:#4c4545}.right-container[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]{padding:8px;border-radius:6px;font-size:12px}.right-container[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{padding:8px;text-align:center;border:solid 1px #4c4545;border-top-right-radius:6px;border-top-left-radius:6px}.right-container[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]   .type[_ngcontent-%COMP%]{font-size:8px;padding:4px;text-align:center;border-bottom-right-radius:6px;border-bottom-left-radius:6px;border:solid 1px #4c4545;background-color:#9d9d9d}.right-container[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]   .type.Public[_ngcontent-%COMP%]{color:#fff}.submitted[_ngcontent-%COMP%]{color:#28a745;border-color:#28a745!important}.approved[_ngcontent-%COMP%]{color:#0b8a3e;border-color:#0b8a3e!important}.approved[_ngcontent-%COMP%]     .btn{color:#0b8a3e;border-color:#0b8a3e!important}.in_progress[_ngcontent-%COMP%]{color:#f0ad4e;border-color:#28a745!important}.in_progress[_ngcontent-%COMP%]     .btn{color:#f0ad4e;border-color:#f0ad4e!important}.resolved[_ngcontent-%COMP%]{color:#6c757d;border-color:#6c757d!important}.resolved[_ngcontent-%COMP%]     .btn{color:#6c757d;border-color:#6c757d!important}.closed[_ngcontent-%COMP%]{color:#888;border-color:#888!important}.closed[_ngcontent-%COMP%]     .btn{color:#888;border-color:#888!important}.rejected[_ngcontent-%COMP%]{color:#d12b2b;border-color:#d12b2b!important}.rejected[_ngcontent-%COMP%]     .btn{color:#d12b2b;border-color:#d12b2b!important}.action[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;display:flex;gap:8px}@media (max-width: 767px){.action[_ngcontent-%COMP%]     button{font-size:12px;padding:8px}}@media (min-width: 768px) and (max-width: 991px){.action[_ngcontent-%COMP%]     button{font-size:12px;padding:8px}}"]})}}return n})();var Lt=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=_({type:n,selectors:[["app-complaint-filter"]],decls:2,vars:1,consts:[[3,"hideMoreActions"]],template:function(i,e){i&1&&(a(0,"app-layout",0),p(1,"ui-form-layout"),s()),i&2&&l("hideMoreActions",!0)},dependencies:[I,S]})}}return n})();function Qt(n,g){if(n&1&&p(0,"ui-label",10),n&2){let t=m();l("config",t.errorConfig)("valueText",t.errorMessage)("smColumns",12)("mdColumns",12)("lgColumns",12)}}var T=(()=>{class n{constructor(t,i,e,o){this.societyService=t,this.route=i,this.location=e,this.complaintService=o,this.errorMessage="",this.isComponentActive=new A,this.titleConfig={id:"title",label:"Title",placeholder:"Enter Title",validations:[{name:"required",validator:F.required},{name:"minlength",validator:F.minLength(3)}],errorMessages:{required:"Title is required",minlength:"Minimum 3 characters required"}},this.descriptionConfig={id:"description",label:"Description",placeholder:"Enter Description",validations:[{name:"required",validator:F.required},{name:"minlength",validator:F.minLength(3)}],errorMessages:{required:"Description is required",minlength:"Minimum 3 characters required"}},this.priorityTabsConfig={id:"priority",label:"Priority"},this.complaintTypeTabsConfig={id:"complaintType",label:"Complaint Type"},this.flatSearchConfig={id:"flat",label:"Flat",placeholder:"Select Flat"},this.errorConfig={id:"error",label:""},this.priorityOptions=[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"},{value:"urgent",label:"Urgent"}],this.complaintTypeOptions=[{value:"Private",label:"Private"},{value:"Public",label:"Public"}],this.flatOptions=[],this.fb=new at({flat:new f(void 0),title:new f("New Complaint"),description:new f("New Complaint"),priority:new f("low"),complaintType:new f("Private"),status:new f("submitted")})}ngOnInit(){this.societyId=this.route.snapshot.paramMap.get("id")??void 0,this.flatId=this.route.snapshot.paramMap.get("flatId")??void 0,this.flatId&&!this.societyId&&this.loadFlatDetails(this.flatId),this.loadAllMyFlats(this.societyId),this.fb.get("flat")?.valueChanges.pipe(H(this.isComponentActive)).subscribe({next:t=>{t?(this.flatId=t.value,this.loadFlatDetails(t.value)):this.flat=void 0}})}loadFlatDetails(t){this.societyService.getFlat(t).pipe(h(1)).subscribe({next:i=>{this.flat=i}})}loadAllMyFlats(t){this.societyService.myFlats(t).pipe(h(1)).subscribe(i=>{if(i.success){if(this.flatOptions=i.data.map(e=>this.societyService.convertFlatMemberToDropdownOption(e)),this.flatOptions.length===1)this.fb.get("flat")?.setValue(this.flatOptions[0]);else if(this.flatId){let e=this.flatOptions.find(o=>o.value===this.flatId);e&&this.fb.get("flat")?.setValue(e)}}})}cancel(){this.location.back()}save(){if(!this.fb.valid)return;let t=this.fb.value,i={flatId:this.flatId,societyId:this.flat?this.flat.societyId:this.societyId,title:t.title??"",description:t.description,priority:t.priority,complaintType:t.complaintType,status:t.status};this.complaintService.newComplaint(i).pipe(h(1)).subscribe({next:e=>{e.success?this.cancel():this.errorMessage=e.message??"Failed to add complaint"}})}ngOnDestroy(){this.isComponentActive.next(),this.isComponentActive.complete()}static{this.\u0275fac=function(i){return new(i||n)(u(xt),u(nt),u(X),u(B))}}static{this.\u0275cmp=_({type:n,selectors:[["app-add-complaint"]],decls:12,vars:35,consts:[[1,"layout-container",3,"formGroup"],["formControlName","flat","placeholder","Search Flat",3,"config","options","smColumns","mdColumns","lgColumns"],["formControlName","title",3,"config","smColumns","mdColumns","lgColumns"],["formControlName","description",3,"config","smColumns","mdColumns","lgColumns"],["formControlName","priority",3,"config","tabs","smColumns","mdColumns","lgColumns"],["formControlName","complaintType",3,"config","tabs","smColumns","mdColumns","lgColumns"],["valueType","error",3,"config","valueText","smColumns","mdColumns","lgColumns",4,"ngIf"],[1,"flex","ui-form-layout","flex-end",3,"smColumns","mdColumns","lgColumns"],["label","Cancel","type","cancel",3,"clicked","smColumns","mdColumns","lgColumns"],["label","Save","type","primary",3,"clicked","smColumns","mdColumns","lgColumns","disable"],["valueType","error",3,"config","valueText","smColumns","mdColumns","lgColumns"]],template:function(i,e){i&1&&(a(0,"app-layout")(1,"form",0)(2,"ui-form-layout"),p(3,"ui-select2",1)(4,"ui-text-box",2)(5,"ui-text-box",3)(6,"ui-tabs",4)(7,"ui-tabs",5),O(8,Qt,1,5,"ui-label",6),a(9,"div",7)(10,"ui-button",8),d("clicked",function(){return e.cancel()}),s(),a(11,"ui-button",9),d("clicked",function(){return e.save()}),s()()()()()),i&2&&(r(),l("formGroup",e.fb),r(2),l("config",e.flatSearchConfig)("options",e.flatOptions)("smColumns",12)("mdColumns",12)("lgColumns",4),r(),l("config",e.titleConfig)("smColumns",12)("mdColumns",6)("lgColumns",4),r(),l("config",e.descriptionConfig)("smColumns",12)("mdColumns",6)("lgColumns",4),r(),l("config",e.priorityTabsConfig)("tabs",e.priorityOptions)("smColumns",12)("mdColumns",6)("lgColumns",6),r(),l("config",e.complaintTypeTabsConfig)("tabs",e.complaintTypeOptions)("smColumns",12)("mdColumns",6)("lgColumns",6),r(),l("ngIf",e.errorMessage),r(),l("smColumns",12)("mdColumns",12)("lgColumns",12),r(),l("smColumns",6)("mdColumns",2)("lgColumns",2),r(),l("smColumns",6)("mdColumns",2)("lgColumns",2)("disable",e.fb.invalid))},dependencies:[j,I,S,bt,vt,ft,N,U,V,mt,D,st,ct,dt],styles:[".layout-container[_ngcontent-%COMP%]{overflow:hidden;background:#f4f4f4;padding:16px}"]})}}return n})();var Wt=[{path:"",pathMatch:"full",redirectTo:"list"},{path:"list",component:At},{path:"filter",component:Lt},{path:"add",component:T},{path:"add",component:T},{path:":id/add",component:T},{path:":id/add/:flatId",component:T},{path:"add/:flatId",component:T}],Et=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=E({type:n})}static{this.\u0275inj=L({imports:[q.forChild(Wt),q]})}}return n})();var Ne=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=E({type:n})}static{this.\u0275inj=L({imports:[et,Et,Tt,St,It,ut,Ct,_t,yt,wt]})}}return n})();export{Ne as ComplaintModule};
