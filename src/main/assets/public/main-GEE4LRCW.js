import{a as d,b as he}from"./chunk-CQ7VKFDM.js";import"./chunk-JAYNSCF4.js";import{C as Se,D as Me,a as ve,c as ye,d as Ce,n as Ne,z as Ie}from"./chunk-7RVF455G.js";import{C as ae,K as le,L as ce,M as me,O as pe,c as x,d as Q,e as ee,f as te,h as ie,j as oe,k as h,ka as k,la as ue,m as I,ma as T,o as re,p as j,pa as fe,ra as ge,t as w,v as ne,y as se}from"./chunk-UR6Q7DSA.js";import{$a as A,A as q,Aa as Y,Ab as D,E as b,Lb as R,Lc as $,Mb as E,R as G,Sa as g,Ta as a,U as l,Ua as Z,V as u,Wa as H,Ya as J,Z as c,_ as W,_a as K,da as C,ea as f,ha as V,jb as P,m as z,rb as v,sb as N,tb as F,wc as X,y as B}from"./chunk-WBOKHTJO.js";import{c as S,d as de}from"./chunk-OQV6BHXQ.js";import{f as y}from"./chunk-CWTPBX7D.js";var p=(()=>{class t{constructor(e,i){this.loginService=e,this.router=i}canActivate(e,i){let o=this.loginService.isLoggedIn(),n=i.url;return o?n.startsWith("/login")?this.router.createUrlTree(["/dashboard"]):!0:o||n.startsWith("/login")?!0:this.router.createUrlTree(["/login"])}static{this.\u0275fac=function(i){return new(i||t)(c(j),c(h))}}static{this.\u0275prov=l({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Be=[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",loadChildren:()=>import("./chunk-XELFY6AI.js").then(t=>t.LoginModule),canActivate:[p]},{path:"dashboard",loadChildren:()=>import("./chunk-IIQEJ635.js").then(t=>t.DashboardModule),canActivate:[p]},{path:"society",loadChildren:()=>import("./chunk-QZRIIWHS.js").then(t=>t.SocietyModule),canActivate:[p]},{path:"myflats",loadChildren:()=>import("./chunk-JQ75BUHB.js").then(t=>t.FlatModule),canActivate:[p]},{path:"complaints",loadChildren:()=>import("./chunk-ER6VDV6O.js").then(t=>t.ComplaintModule),canActivate:[p]},{path:"gatepass",loadChildren:()=>import("./chunk-NQLU47TL.js").then(t=>t.GatePassModule),canActivate:[p]},{path:"gateentry",loadChildren:()=>import("./chunk-JV2GSADZ.js").then(t=>t.GateEntryModule),canActivate:[p]},{path:"visitors",loadChildren:()=>import("./chunk-3RXXTBAW.js").then(t=>t.VisitorModule),canActivate:[p]},{path:"unauthorized",loadChildren:()=>import("./chunk-37ZJ6BVJ.js").then(t=>t.UnauthorizedModule)},{path:"**",loadChildren:()=>import("./chunk-K4EGJVLW.js").then(t=>t.PageNotFoundModule)}],be=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=f({type:t})}static{this.\u0275inj=u({imports:[I.forRoot(Be),I]})}}return t})();var Ae=(()=>{class t{constructor(e){this.dialogRef=e,this.userNameConfig={id:"userName",label:"Your Name",placeholder:"Enter Your Name",validations:[{name:"required",validator:w.required},{name:"minlength",validator:w.minLength(3)}],errorMessages:{required:"Your Name is required.",minlength:"Minimum 3 characters required"}},this.userNameFormControl=new se(null,w.required)}save(){this.userNameFormControl.valid&&this.dialogRef.close(this.userNameFormControl.value)}static{this.\u0275fac=function(i){return new(i||t)(a(k))}}static{this.\u0275cmp=C({type:t,selectors:[["app-user-name-input-popup"]],decls:5,vars:12,consts:[[1,"layout-body"],[3,"formControl","config","smColumns","mdColumns","lgColumns"],[1,"flex","flex-end","flex-gap",3,"smColumns","mdColumns","lgColumns"],["label","Save",3,"clicked","smColumns","mdColumns","lgColumns","disable"]],template:function(i,o){i&1&&(v(0,"div",0)(1,"ui-form-layout"),F(2,"ui-text-box",1),v(3,"section",2)(4,"ui-button",3),D("clicked",function(){return o.save()}),N()()()()),i&2&&(g(2),P("formControl",o.userNameFormControl)("config",o.userNameConfig)("smColumns",12)("mdColumns",12)("lgColumns",12),g(),P("smColumns",12)("mdColumns",12)("lgColumns",12),g(),P("smColumns",12)("mdColumns",3)("lgColumns",3)("disable",o.userNameFormControl.invalid))},dependencies:[ye,Ce,fe,Ne,ne,ae],styles:[".layout-body[_ngcontent-%COMP%]{flex:1;overflow-y:auto;background:#f4f4f4;padding:16px}"]})}}return t})();var Pe=(()=>{class t{constructor(e,i,o){this.router=e,this.ngZone=i,this.platform=o,this.isInitialized=!1}initialize(){return y(this,null,function*(){if(!this.isInitialized){if(!S.isNativePlatform()){console.log("Push notifications only work on native platforms");return}try{(yield d.requestPermissions()).receive==="granted"?(yield d.register(),this.setupListeners(),this.isInitialized=!0,console.log("Push notifications initialized")):console.log("User denied push notification permission")}catch(e){console.error("Error initializing push notifications:",e)}}})}setupListeners(){d.addListener("registration",e=>{console.log("Push registration success, token:",e.value),this.sendTokenToServer(e.value)}),d.addListener("registrationError",e=>{console.error("Push registration error:",e)}),d.addListener("pushNotificationReceived",e=>{console.log("Push received (foreground):",e)}),d.addListener("pushNotificationActionPerformed",e=>y(this,null,function*(){console.log("Push action performed:",e),this.ngZone.run(()=>{this.handleNotificationClick(e.notification)})}))}handleNotificationClick(e){console.log("Handling notification click:",e);let i=e.data||{},o=i.notificationId,n=i.type,s=i.gateEntryId;console.log("Notification data:",{notificationId:o,type:n,gateEntryId:s,allData:i}),n==="GATE_PASS"&&s?this.router.navigate(["/visitors/list"]):o?this.router.navigate(["/notifications",o]):this.router.navigate(["/home"])}sendTokenToServer(e){console.log("Sending FCM token to server:",e)}removeAllListeners(){return y(this,null,function*(){yield d.removeAllListeners()})}getDeliveredNotifications(){return y(this,null,function*(){let e=yield d.getDeliveredNotifications();return console.log("Delivered notifications:",e),e})}removeDeliveredNotifications(){return y(this,null,function*(){yield d.removeAllDeliveredNotifications()})}static{this.\u0275fac=function(i){return new(i||t)(c(h),c(A),c(pe))}}static{this.\u0275prov=l({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var L=de("App",{web:()=>import("./chunk-CHETKA5J.js").then(t=>new t.AppWeb)});var Fe=(()=>{class t{constructor(e){this.router=e,this.notificationData=null,this.setupAppStateListeners()}setupAppStateListeners(){S.isNativePlatform()&&(L.addListener("appStateChange",e=>{e.isActive&&this.notificationData&&this.handlePendingNotification()}),L.addListener("appUrlOpen",e=>{console.log("App opened with URL:",e)}))}setNotificationData(e){this.notificationData=e}handlePendingNotification(){this.notificationData&&setTimeout(()=>{this.routeBasedOnNotification(this.notificationData),this.notificationData=null},1e3)}routeBasedOnNotification(e){let i=e.notificationId,o=e.type,n=e.gateEntryId;o==="GATE_PASS"&&n?this.router.navigate(["/gate-entries",n]):i&&this.router.navigate(["/notifications",i])}static{this.\u0275fac=function(i){return new(i||t)(c(h))}}static{this.\u0275prov=l({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var De=(()=>{class t{constructor(e,i,o,n,s,M,Oe,Le,_e){this.router=e,this.menuService=i,this.loginService=o,this.dialog=n,this.userService=s,this.FcmTokenService=M,this.consoleService=Oe,this.pushNotificationService=Le,this.coldStartService=_e,this.show=!1,this.title="SocietyManagementUI"}ngOnInit(){this.FcmTokenService.init(),this.router.events.pipe(B(e=>e instanceof ie)).subscribe(e=>{this.menuService.userMenus.subscribe(i=>{this.menuService.syncSelectedMenuWithCurrentUrl(),this.checkAndAskForUserName()})}),setTimeout(()=>{this.router.url==="/dashboard/user"&&this.menuService.syncSelectedMenuWithCurrentUrl(!0),this.pushNotificationService.initialize()},100)}checkAndAskForUserName(){setTimeout(()=>{let e=this.loginService.getProfileFromStorage()?.user;this.loginService.isLoggedIn()&&e&&!e.name&&!this.dialogRef&&(this.dialogRef=this.dialog.open(Ae),this.dialogRef.afterClosed().pipe(b(1)).subscribe(i=>{this.dialogRef=void 0,!(!i||typeof i!="string")&&this.userService.updateUserName(i).pipe(b(1)).subscribe(o=>{o.success&&this.updateUserToken(o.token)})}))},1e3)}updateUserToken(e){this.loginService.saveTokenToStorage(e),this.loginService.loadProfile().pipe(b(1)).subscribe(i=>{!i||i.success})}checkPendingNotifications(){let e=localStorage.getItem("pendingNotification");if(e)try{let i=JSON.parse(e);this.coldStartService.setNotificationData(i),localStorage.removeItem("pendingNotification")}catch(i){console.error("Error parsing pending notification:",i)}}ngOnDestroy(){this.pushNotificationService.removeAllListeners()}static{this.\u0275fac=function(i){return new(i||t)(a(h),a(re),a(j),a(T),a(me),a(he),a(ve),a(Pe),a(Fe))}}static{this.\u0275cmp=C({type:t,selectors:[["app-root"]],decls:1,vars:0,template:function(i,o){i&1&&F(0,"router-outlet")},dependencies:[oe]})}}return t})();var We="@",Ve=(()=>{class t{constructor(e,i,o,n,s){this.doc=e,this.delegate=i,this.zone=o,this.animationType=n,this.moduleImpl=s,this._rendererFactoryPromise=null,this.scheduler=W(H,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-5P5JOLN4.js")).catch(i=>{throw new G(5300,!1)}).then(({\u0275createEngine:i,\u0275AnimationRendererFactory:o})=>{this._engine=i(this.animationType,this.doc,this.scheduler);let n=new o(this.delegate,this._engine,this.zone);return this.delegate=n,n})}createRenderer(e,i){let o=this.delegate.createRenderer(e,i);if(o.\u0275type===0)return o;typeof o.throwOnSyntheticProps=="boolean"&&(o.throwOnSyntheticProps=!1);let n=new _(o);return i?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(s=>{let M=s.createRenderer(e,i);n.use(M)}).catch(s=>{n.use(o)}),n}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}static{this.\u0275fac=function(i){Z()}}static{this.\u0275prov=l({token:t,factory:t.\u0275fac})}}return t})(),_=class{constructor(r){this.delegate=r,this.replay=[],this.\u0275type=1}use(r){if(this.delegate=r,this.replay!==null){for(let e of this.replay)e(r);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(r,e){return this.delegate.createElement(r,e)}createComment(r){return this.delegate.createComment(r)}createText(r){return this.delegate.createText(r)}get destroyNode(){return this.delegate.destroyNode}appendChild(r,e){this.delegate.appendChild(r,e)}insertBefore(r,e,i,o){this.delegate.insertBefore(r,e,i,o)}removeChild(r,e,i){this.delegate.removeChild(r,e,i)}selectRootElement(r,e){return this.delegate.selectRootElement(r,e)}parentNode(r){return this.delegate.parentNode(r)}nextSibling(r){return this.delegate.nextSibling(r)}setAttribute(r,e,i,o){this.delegate.setAttribute(r,e,i,o)}removeAttribute(r,e,i){this.delegate.removeAttribute(r,e,i)}addClass(r,e){this.delegate.addClass(r,e)}removeClass(r,e){this.delegate.removeClass(r,e)}setStyle(r,e,i,o){this.delegate.setStyle(r,e,i,o)}removeStyle(r,e,i){this.delegate.removeStyle(r,e,i)}setProperty(r,e,i){this.shouldReplay(e)&&this.replay.push(o=>o.setProperty(r,e,i)),this.delegate.setProperty(r,e,i)}setValue(r,e){this.delegate.setValue(r,e)}listen(r,e,i){return this.shouldReplay(e)&&this.replay.push(o=>o.listen(r,e,i)),this.delegate.listen(r,e,i)}shouldReplay(r){return this.replay!==null&&r.startsWith(We)}};function Re(t="animations"){return K("NgAsyncAnimations"),V([{provide:J,useFactory:(r,e,i)=>new Ve(r,e,i,t),deps:[X,Q,A]},{provide:Y,useValue:t==="noop"?"NoopAnimations":"BrowserAnimations"}])}var je=(()=>{class t{intercept(e,i){let o=localStorage.getItem("auth_token"),n=localStorage.getItem("fcmToken");if(!o)return i.handle(e);let s=e.headers.set("Authorization",`Bearer ${o}`);n&&(s=s.set("fcmToken",n));let M=e.clone({headers:s});return i.handle(M)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=l({token:t,factory:t.\u0275fac})}}return t})();var we=(()=>{class t{constructor(e,i){this.dialogRef=e,this.data=i}close(){this.dialogRef.close()}static{this.\u0275fac=function(i){return new(i||t)(a(k),a(ue))}}static{this.\u0275cmp=C({type:t,selectors:[["app-error-dialog"]],decls:8,vars:2,consts:[[1,"error-dialog"],[1,"title"],[1,"message"],[1,"actions"],["type","button",1,"btn","primary",3,"click"]],template:function(i,o){i&1&&(v(0,"div",0)(1,"h2",1),R(2),N(),v(3,"p",2),R(4),N(),v(5,"div",3)(6,"button",4),D("click",function(){return o.close()}),R(7,"OK"),N()()()),i&2&&(g(2),E(o.data.title),g(2),E(o.data.message))},styles:[".error-dialog[_ngcontent-%COMP%]{padding:24px;min-width:280px}.error-dialog[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{margin:0 0 8px;font-size:1.2rem;color:#0b4da0}.error-dialog[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{margin-bottom:16px;color:#6b7280}.error-dialog[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"]})}}return t})();var ke=(()=>{class t{constructor(e){this.dialog=e,this.dialogOpen=!1}open(e,i){if(this.dialogOpen)return;this.dialogOpen=!0,this.dialog.open(we,{disableClose:!0,data:{title:e,message:i}}).afterClosed().subscribe(()=>{this.dialogOpen=!1})}static{this.\u0275fac=function(i){return new(i||t)(c(T))}}static{this.\u0275prov=l({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Te=(()=>{class t{constructor(e){this.errorDialogService=e}intercept(e,i){return i.handle(e).pipe(q(o=>{console.log(o);let n="Unexpected Error",s="Something went wrong. Please try again.";return o.error?.message?s=o.error.message:o.message&&(s=o.message),o.status===0?(n="Network Error",s="Unable to connect to server."):o.status===401?n="Unauthorized":o.status===403?n="Forbidden":o.status===404?n="Not Found":o.status>=500&&(n="Server Error"),this.errorDialogService.open(n,s),z(()=>o)}))}static{this.\u0275fac=function(i){return new(i||t)(c(ke))}}static{this.\u0275prov=l({token:t,factory:t.\u0275fac})}}return t})();var Ze=[],Ee=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=f({type:t})}static{this.\u0275inj=u({imports:[I.forChild(Ze),I]})}}return t})();var xe=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=f({type:t})}static{this.\u0275inj=u({imports:[$,Ee,Me,Se,Ie,le,ce]})}}return t})();var Ue=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=f({type:t,bootstrap:[De]})}static{this.\u0275inj=u({providers:[Re(),{provide:x,useClass:je,multi:!0},{provide:x,useClass:Te,multi:!0}],imports:[te,be,ge,xe]})}}return t})();S.isNativePlatform()&&d.addListener("pushNotificationActionPerformed",t=>{localStorage.setItem("pendingNotification",JSON.stringify(t.notification.data))});ee().bootstrapModule(Ue).catch(t=>console.error(t));
